package moshi.blossom.module.impl.exploit.disablers;

import moshi.blossom.event.impl.player.MotionEvent;
import moshi.blossom.module.ModManager;
import moshi.blossom.module.ModuleMode;
import moshi.blossom.util.network.PacketUtil;
import net.minecraft.entity.Entity;
import net.minecraft.network.Packet;
import net.minecraft.network.play.client.C07PacketPlayerDigging;
import net.minecraft.network.play.client.C0BPacketEntityAction;
import net.minecraft.util.BlockPos;
import net.minecraft.util.EnumFacing;
import nevalackin.homoBus.Listener;
import nevalackin.homoBus.annotations.EventLink;

public class VulcanDisabler extends ModuleMode {

    @EventLink
    private final Listener<MotionEvent> handleMotion;

    public VulcanDisabler() {
        super("Vulcan");

        this.handleMotion = event -> {
            if (event.isPost()) return;

            // Send sprint packets if Scaffold is active
            if (ModManager.getMod("Scaffold").isToggled()) {
                sendSprintPackets();

            }

            // Always send block destroy packet
            sendBlockDestroyPacket();

        };

    }

    private void sendSprintPackets() {
        Entity player = mc.thePlayer;

        PacketUtil.send(new C0BPacketEntityAction(player, C0BPacketEntityAction.Action.START_SPRINTING));

        PacketUtil.send(new C0BPacketEntityAction(player, C0BPacketEntityAction.Action.STOP_SPRINTING));

    }

    private void sendBlockDestroyPacket() {
        Entity player = mc.thePlayer;

        PacketUtil.send(new C07PacketPlayerDigging(
        C07PacketPlayerDigging.Action.STOP_DESTROY_BLOCK,
        new BlockPos(player),
        EnumFacing.UP
        ));

    }

}
