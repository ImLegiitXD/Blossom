package moshi.blossom.module.impl.exploit;

import javax.vecmath.Vector3d;
import moshi.blossom.event.impl.network.PacketEvent;
import moshi.blossom.event.impl.player.MotionEvent;
import moshi.blossom.event.impl.player.MoveEvent;
import moshi.blossom.module.Module;
import moshi.blossom.option.impl.ModeOption;
import moshi.blossom.util.network.Packets;
import moshi.blossom.util.player.MoveUtil;
import nevalackin.homoBus.Listener;
import nevalackin.homoBus.annotations.EventLink;

public class BedBreaker extends Module {

public final ModeOption modeOption = new ModeOption("MODE", "Mode", "Spec", new String[]{"Spec"});

    private Vector3d posVec;

    private boolean nextTp;

    @EventLink
    public Listener<MoveEvent> handleMove;

    @EventLink
    public Listener<MotionEvent> handleMotion;

    @EventLink
    public Listener<PacketEvent> handlePacket;

    public BedBreaker() {
        super("BedBreaker", "Bed Breaker", Category.EXPLOIT);

        this.handleMove = event -> {
            // Handle movement
            if (MoveUtil.isMoving()) {
                event.setSpeed(5.0D);

            } else {
                event.setSpeed(0.0D);

            }

            event.setY(0.0D);

            // Handle vertical movement
            if (mc.gameSettings.keyBindJump.isKeyDown()) {
                event.setY(3.0D);

            }

            if (mc.gameSettings.keyBindSneak.isKeyDown()) {
                event.setY(-3.0D);

            }

        };

        this.handleMotion = event -> {
            // Handle teleportation
            if (nextTp) {
                getPlayer().setPosition(posVec.x, posVec.y, posVec.z);

            }

        };

        this.handlePacket = event -> {
            // Detect position packets
            if (event.getPacket().pType() == Packets.S_PLAYER_POS_LOOK) {
                nextTp = true;

            }

        };

    }

    @Override
    public void onEnable() {
        super.onEnable();

        this.nextTp = false;

        this.posVec = new Vector3d(getPlayer().posX, getPlayer().posY, getPlayer().posZ);

    }

    @Override
    public void onDisable() {
        super.onDisable();

    }

}
